---
 - hosts: all
   vars:
     config_file_path: "{{ lookup('env','HOME') }}/.config/sap_config.ini"
     ansible_user: "{{ target_sap_sid | lower}}adm"
     ansible_ssh_pass: "{{ lookup('ini', 'remote_ssh_passwd section=SAP file={{ config_file_path }}') }}"
   roles:
     - role: copy_exp_ctl
       when: '"Windows" not in ansible_facts["distribution"]'

     - role: win_copy_exp_ctl
       vars:
         config_file_path: "{{ ansible_env.USERPROFILE }}/system_refresh/{{ target_sap_sid }}/.config/sap_config.ini"
       when: '"Windows" in ansible_facts["distribution"]'

 - hosts: all
   vars:
     ansible_connection: local
     ansible_python_interpreter: /usr/bin/python3
   roles:
     - role: export_system_tables
       vars:
         config_file_path: "{{ ansible_env.HOME }}/system_refresh/{{ target_sap_sid }}/.config/sap_config.ini"

